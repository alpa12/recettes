name: Quarto Smoke

on:
  pull_request:
    paths:
      - '**/*.qmd'
      - '_quarto.yml'
      - 'styles.css'
      - 'includes/**'
      - 'livrec/**'
      - 'recettes/**/*.yaml'
  push:
    branches: [main, dev]
    paths:
      - '**/*.qmd'
      - '_quarto.yml'
      - 'styles.css'
      - 'includes/**'
      - 'livrec/**'
      - 'recettes/**/*.yaml'

concurrency:
  group: ${{ github.workflow }}-${{ github.event.pull_request.number || github.ref }}
  cancel-in-progress: true

jobs:
  smoke:
    runs-on: ubuntu-latest
    timeout-minutes: 20
    steps:
      - uses: actions/checkout@v4
      - name: Setup R environment
        uses: ./.github/actions/setup-r-livrec
        with:
          r-version: '4.5.2'
      - uses: quarto-dev/quarto-actions/setup@v2
      - name: Render smoke pages
        run: |
          quarto render index.qmd
          quarto render recettes/repas/index.qmd
